var TL=TL||function(){var e=[],t={UFP:{path:"js/data/UFP.json",id:"oesera6",name:"United Federation of Planets"},KLE:{path:"js/data/KLE.json",id:"o15noc3",name:"Klingon Empire"},RSA:{path:"js/data/RSA.json",id:"or7u0kt",name:"Romulan Star Empire"},TRI:{path:"js/data/TRI.json",id:"ol08r1n",name:"Triangle"},ORC:{path:"js/data/ORC.json",id:"ohu3d91",name:"Orion Colonies"},RFW:{path:"js/data/RFW.json",id:"oypmvfb",name:"Romulan/Federation War"},FYW:{path:"js/data/FYW.json",id:"oi1ju2s",name:"Four Years War"},ST3:{path:"js/data/ST3.json",id:"o5oxeec",name:"Star Trek 3 Update"},ST4:{path:"js/data/ST4.json",id:"oxxpvso",name:"Star Trek 4 Update"},SFI:{path:"js/data/SFI.json",id:"ohqn30t",name:"Starfleet Intelligence"},ITA:{path:"js/data/ITA.json",id:"orojt89",name:"UFP/Independent Traders' Association"}},a={resizeTasks:[],events:[],data:{},init:function(){a.props={$bodyElement:$("body"),$navbar:$("#navbar"),$inputCentury:$("#century-search"),$sourceToggles:$("#tl-source"),$sourceToolbar:$("#source-toolbar"),$timeline:$("#timeline"),$pageHeader:$("#page-header"),$pageFooter:$("#page-footer"),$pageFooterContent:$("#page-footer-content")};var e=_.throttle(a.manageResize,250);$(window).resize(e),a.manageResize();var t={func:function(){var e=a.props.$pageFooterContent.outerHeight(!0);a.props.$pageFooter.height(e),a.props.$bodyElement.css("padding-bottom",e);a.getSiteViewType();a.props.$bodyElement.css("padding-top",a.props.$navbar.outerHeight(!0))},args:[]};t.func(t.args),a.addResizeTask(t),a.getData(),a.addListeners()},addResizeTask:function(e){e.args=e.args||[],a.resizeTasks.push(e)},getData:function(){function n(e){var t,a,n;return t=e.replace(/,/g,"").split("/"),n={year:2e3+100*Number(t[0])+Number(t[1].substring(0,2))},t[1].length>2&&(a=t[1].split(".")),n.century=t[0],n.month=a[0].substring(2,4),n.date=a[1]||"00",n.month="00"===n.month?"01":n.month,n.date="00"===n.date?"01":n.date,n}$.each(t,function(t,s){s.dfd=$.Deferred(),e.push(s.dfd),$.ajax({url:s.path,dataType:"json"}).success(function(e){a.data[t]=e.feed.entry;for(var o=0;o<e.feed.entry.length;o++){var r=n(e.feed.entry[o].gsx$stardate.$t);a.events.push({stardate:e.feed.entry[o].gsx$stardate.$t,sortkey:Number(r.year+"."+r.month+r.date),end:e.feed.entry[o].gsx$stardateend.$t||null,century:r.century,year:r.year,month:r.month,date:r.date,source:e.feed.title.$t,full:"TRUE"===e.feed.entry[o].gsx$full.$t,desc:e.feed.entry[o].gsx$event.$t})}s.dfd.resolve()})}),$.when.apply(null,e).done(function(){a.events=_.sortBy(a.events,"year"),a.buildTimeline($("#tl-list"))})},buildTimeline:function(e){_.allKeys(t);_.each(t,function(t,a,n){e.addClass(a)});for(var n=$(document.createDocumentFragment()),s=0;s<a.events.length;++s){a.events[s].id=s;var o=$("<li/>",{id:"tl-event-"+s,"class":"tl-event "+a.events[s].source+" tl-full-"+a.events[s].full,"data-century":a.events[s].century}),r=$("<div/>",{"class":"tl-badge"}),l=$("<div/>",{"class":"tl-panel"}),i=$("<div/>",{"class":"tl-heading"}),d=$("<h4/>",{"class":"tl-title",text:a.events[s].stardate}),p=$("<div/>",{"class":"tl-body"});i.append(d).append('<p><small class="tl-subtext text-muted"><i class="glyphicon glyphicon-folder-open"></i>'+t[a.events[s].source].name+"</small></p>"),p.append(a.events[s].desc),l.append(i).append(p),o.append(r).append(l),n.append(o)}e.append(n),a.props.$bodyElement.removeClass("loading"),a.alternateFloats()},addListeners:function(){function e(){var e=a.props.$inputCentury.val();if(""!==e)if(NaN===Number(e))a.props.$inputCentury.val("");else{var t=null,n=a.props.$pageHeader.outerHeight(!0);$(".tl-event:visible").each(function(a){var s=$(this).data("century");if(s>=e)return t=n+$(this).position().top,!1}),null!==t&&(a.scrollToPosition(t),a.props.$inputCentury.val(""))}}a.props.$bodyElement.on("click",function(t){function n(e){s.hasClass("active")?(s.removeClass("active"),a.props.$timeline.removeClass(e)):(s.addClass("active"),a.props.$timeline.addClass(e))}var s=$(t.target);switch(t.target.id){case"UFP-toggle":n("UFP");break;case"KLE-toggle":n("KLE");break;case"KLE-full":n("KLE-full");break;case"RSA-toggle":n("RSA");break;case"RSA-full":n("RSA-full");break;case"ORC-toggle":n("ORC");break;case"ORC-full":n("ORC-full");break;case"TRI-toggle":n("TRI");break;case"ST3-toggle":n("ST3");break;case"ST4-toggle":n("ST4");break;case"SFI-toggle":n("SFI");break;case"ITA-toggle":n("ITA");break;case"RFW-toggle":n("RFW");break;case"FYW-toggle":n("FYW");break;case"btn-return-top":a.scrollToPosition(0);break;case"navbar-brand":window.scrollTo(0,0);break;case"btn-footer":a.scrollToPosition(a.props.$pageFooter.position().top);break;case"btn-search":e()}a.alternateFloats()}),a.props.$inputCentury.on("keypress",function(t){"13"==t.which&&(t.preventDefault(),e())})},scrollToPosition:function(e){$("html,body").animate({scrollTop:e},1e3)},alternateFloats:function(){$(".tl-inverted").removeClass("tl-inverted"),$(".tl-event:visible").each(function(e){(e+1)%2===0&&$(this).addClass("tl-inverted")})},manageResize:function(){for(var e=0;e<a.resizeTasks.length;e++){var t=a.resizeTasks[e];t.func.apply(this,t.args)}},getSiteViewType:function(){var e={xs:480,sm:768,md:992,lg:1200},t=a.props.$bodyElement.outerWidth(!0),n="xs";return t>=e.sm&&(n="sm"),t>=e.md&&(n="md"),t>=e.lg&&(n="lg"),n}};return a}();$(document).ready(function(){TL.init()});