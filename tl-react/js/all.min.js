var TL=TL||function(){var e={resizeTasks:[],events:[],data:{},init:function(){e.props={$bodyElement:$("body"),$navbar:$("#navbar"),$inputCentury:$("#century-search"),$sourceToggles:$("#tl-source"),$sourceToolbar:$("#source-toolbar"),$timeline:$("#timeline"),$pageHeader:$("#page-header"),$pageFooter:$("#page-footer"),$pageFooterContent:$("#page-footer-content")};var t=_.throttle(e.manageResize,250);$(window).resize(t),e.manageResize();var a={func:function(){var t=e.props.$pageFooterContent.outerHeight(!0);e.props.$pageFooter.height(t),e.props.$bodyElement.css("padding-bottom",t);e.getSiteViewType();e.props.$bodyElement.css("padding-top",e.props.$navbar.outerHeight(!0))},args:[]};a.func(a.args),e.addResizeTask(a),e.getData()},addResizeTask:function(t){t.args=t.args||[],e.resizeTasks.push(t)},getData:function(t){function a(e){var t,a,n;return t=e.replace(/,/g,"").split("/"),n={year:2e3+100*Number(t[0])+Number(t[1].substring(0,2))},t[1].length>2&&(a=t[1].split(".")),n.century=t[0],n.month=a[0].substring(2,4),n.date=a[1]||"00",n.month="00"===n.month?"01":n.month,n.date="00"===n.date?"01":n.date,n}var n=[],o={UFP:{path:"js/data/UFP.json",id:"oesera6",hasFull:!1,name:"United Federation of Planets"},KLE:{path:"js/data/KLE.json",id:"o15noc3",hasFull:!0,name:"Klingon Empire"},RSA:{path:"js/data/RSA.json",id:"or7u0kt",hasFull:!0,name:"Romulan Star Empire"},TRI:{path:"js/data/TRI.json",id:"ol08r1n",hasFull:!1,name:"Triangle"},ORC:{path:"js/data/ORC.json",id:"ohu3d91",hasFull:!0,name:"Orion Colonies"},RFW:{path:"js/data/RFW.json",id:"oypmvfb",hasFull:!1,name:"Romulan/Federation War"},FYW:{path:"js/data/FYW.json",id:"oi1ju2s",hasFull:!1,name:"Four Years War"},ST3:{path:"js/data/ST3.json",id:"o5oxeec",hasFull:!1,name:"Star Trek 3 Update"},ST4:{path:"js/data/ST4.json",id:"oxxpvso",hasFull:!1,name:"Star Trek 4 Update"},SFI:{path:"js/data/SFI.json",id:"ohqn30t",hasFull:!1,name:"Starfleet Intelligence"},ITA:{path:"js/data/ITA.json",id:"orojt89",hasFull:!1,name:"UFP/Independent Traders' Association"}};$.each(o,function(t,o){o.dfd=$.Deferred(),n.push(o.dfd),$.ajax({url:o.path,dataType:"json"}).success(function(n){e.data[t]=n.feed.entry;for(var r=0;r<n.feed.entry.length;r++){var s=a(n.feed.entry[r].gsx$stardate.$t);e.events.push({stardate:n.feed.entry[r].gsx$stardate.$t,sortkey:Number(s.year+"."+s.month+s.date),end:n.feed.entry[r].gsx$stardateend.$t||null,century:s.century,year:s.year,month:s.month,date:s.date,source:n.feed.title.$t,full:"TRUE"===n.feed.entry[r].gsx$full.$t,desc:n.feed.entry[r].gsx$event.$t})}o.dfd.resolve()})}),$.when.apply(null,n).done(function(){e.events=_.sortBy(e.events,"year")})},addListeners:function(){function t(){var t=e.props.$inputCentury.val();if(""!==t)if(NaN===Number(t))e.props.$inputCentury.val("");else{var a=null,n=e.props.$pageHeader.outerHeight(!0);$(".tl-event:visible").each(function(e){var o=$(this).data("century");if(o>=t)return a=n+$(this).position().top,!1}),null!==a&&(e.scrollToPosition(a),e.props.$inputCentury.val(""))}}e.props.$bodyElement.on("click",function(a){$(a.target);switch(a.target.id){case"btn-return-top":e.scrollToPosition(0);break;case"navbar-brand":window.scrollTo(0,0);break;case"btn-footer":e.scrollToPosition(e.props.$pageFooter.position().top);break;case"btn-search":t()}e.alternateFloats()}),e.props.$inputCentury.on("keypress",function(e){"13"==e.which&&(e.preventDefault(),t())})},scrollToPosition:function(e){$("html,body").animate({scrollTop:e},1e3)},alternateFloats:function(){$(".tl-inverted").removeClass("tl-inverted"),$(".tl-event:visible").each(function(e){(e+1)%2===0&&$(this).addClass("tl-inverted")})},manageResize:function(){for(var t=0;t<e.resizeTasks.length;t++){var a=e.resizeTasks[t];a.func.apply(this,a.args)}},getSiteViewType:function(){var t={xs:480,sm:768,md:992,lg:1200},a=e.props.$bodyElement.outerWidth(!0),n="xs";return a>=t.sm&&(n="sm"),a>=t.md&&(n="md"),a>=t.lg&&(n="lg"),n}};return e}();$(document).ready(function(){TL.init()});